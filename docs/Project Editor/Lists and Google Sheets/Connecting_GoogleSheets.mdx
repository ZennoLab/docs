---
sidebar_position: 6
title: Настройка подключения Google Таблиц
description: Разберемся, как подключить Google таблицы к ZennoDroid.
---  
:::info **Пожалуйста, ознакомьтесь с [*Правилами использования материалов на данном ресурсе*](../../Disclaimer).**
:::    

Для использования Google-таблиц в ZennoDroid нужно выполнить действия, описанные в этой статье.  
_______________________________________________
## Добавление нового приложения.  
- Входим в свой Google аккаунт или создаем новый.  
_______________________________________________
- Заходим в [**Google Cloud Platform**](https://console.cloud.google.com/projectselector2/apis/credentials/consent?supportedpurview=project). При первом переходе надо будет:    
    - выбрать страну (1);  
    - ознакомиться с правилами и принять их (2);  
    - согласиться или отказаться от рассылки (3);  
    - в конце нажать **AGREE AND CONTINUE** (4);  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic1.png) 
_______________________________________________
- Выбираем в левой панели **OAuth consent screen (1)** и нажимаем **CREATE PROJECT (2)**, чтобы создать новый проект.  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic2.png)   
_______________________________________________
- Вводим любое название проекта в поле **Project name (1)**, но только на английском языке. И **Location (Местоположение организации) (2)**, а затем **CREATE (3)**.  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic3.png)   
_______________________________________________
- В следующем окне выбираем **External (1)** и снова **CREATE (2)**.  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic4.png)   
_______________________________________________
- В открывшемся окне вводим любое имя приложения **App name (1)** и выбираем email в списке **User support email (2)**.  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic5.png)   
_______________________________________________
- Прокручиваем страницу до конца и еще раз вводим свой **email (3)**, а затем нажмимаем **SAVE AND CONTINUE (4)**.  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic6.png)   
_______________________________________________
- В следующем окне ***Scopes*** просто проматываем страницу в самый низ и нажимаем **SAVE AND CONTINUE**.  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic7.png) 
_______________________________________________
- В окне ***Test users*** тоже пролистываем вниз и нажимаем **SAVE AND CONTINUE**.  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic8.png)  
_______________________________________________
- В новом окне ***Summary*** также листаем до конца и нажимаем **BACK TO DASHBOARD**.  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic9.png)  
_______________________________________________
## Публикация проекта.  
### Testing mode.  
Можно оставить приложение в тестовом режиме. Тогда оно будет доступно только для аккаунта-создателя и пользователей, которые добавлены в список ***Test Users***. 
:::warning **Количество тестовых пользователей ограничено.**  
Их может быть не больше 100. И после добавления пользователя в список тестеров удалить его оттуда уже нельзя!
:::     
#### Как добавить в список Test Users?  
- На вкладке **OAuth consent screen** листаем немного вниз и в разделе ***Test users*** нажмимаем кнопку **`+ADD USERS`**.  
- В открывшемся окне добавляем email необходимого аккаунта и нажмимаем кнопку **SAVE**.  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic10.png)  
_______________________________________________
### Publish App.  
Теперь можно опубликовать приложение, чтобы оно стало доступно всем пользователям, у которых есть Google аккаунт. Для этого достаточно нажать кнопку **PUBLISH APP**.  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic11.png) 
_______________________________________________
## Создание учетных данных.  
- В разделе **Credentials (1)** нажимаем **`+CREATE CREDENTIALS`** (2) и выбираем пункт **OAuth client ID (3)**.  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic12.png)  
_______________________________________________
- Выбираем пункт ***Desktop app*** в выпадающем списке *Application type (1)* и нажимаем **CREATE (2)**.  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic13.png) 
_______________________________________________
- Откроется новое окно **OAuth client created**, в нём кликаем **`OK`**.  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic14.png)  
_______________________________________________
- После этого жмем по названию только что созданного приложения или же по значку его редактирования.  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic15.png)  
_______________________________________________
- В открывшемся окне нужно скачать ключ в виде файла, для этого жмем кнопку **`DOWNLOAD JSON`**.  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic16.png)  

## Работа с API.  
### Включение API от Google.  
:::warning **Очень важно включить именно оба API: для Sheets и Drive, иначе программа будет работать не корректно.**  
:::   
- [**Ссылка для включения Google Sheets API**](https://console.developers.google.com/apis/library/sheets.googleapis.com). Выбираем свой проект и нажимаем **ENABLE**.  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic17.png) 
_______________________________________________
- [**Ссылка для включения Google Drive API**](https://console.developers.google.com/apis/library/drive.googleapis.com). Также выбираем проект, а затем **ENABLE**.  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic18.png)  
_______________________________________________
### Добавление ключа в программу.  
:::warning **Google таблицы нужно подключать отдельно для ProjectMaker и ZennoDroid.**  
:::  

- Открываем **Настройки подключения Google таблиц** (***Редактирование → Настройки → Google таблицы***).  
- Нажимаем многоточие […] в правом крае поля для указания пути и выбираем ***файл учетных данных (1)***, а затем нажимаем **Подключить (2)**.  
:::info **Файл обязательно должен иметь расширение .json.**  
:::  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic19.png)  
_______________________________________________
- После этого откроется окно браузера, где необходимо будет войти в аккаунт Google, с которого вы создавали ключ.  
- Скорее всего появится окно с предупреждением. Поскольку мы доверяем своему приложению, необходимо выбрать *Дополнительные настройки (1)* и *Перейти на страницу "Ваше приложение" (2)*.  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic20.png)   
_______________________________________________
- Теперь даем доступ к данным аккаунта, чтобы можно было читать и записывать таблицы.  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic21.png)  ![Через ProjectMaker](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic22.png)  
_______________________________________________
- И еще раз.  

![Настройка подключения Google Таблиц](./assets/Connecting_GoogleSheets/Connecting_GoogleSheets_pic23.png)  
_______________________________________________
- Если все сделано правильно, то появится надпись:  
`Received verification code. You may now close this window`.   
_______________________________________________
### Лимиты запросов к API.  
#### Какие есть ограничения?
Есть ограничения на количество запросов: 300 запросов в минуту для одного проекта, общее количество за день не ограничено. *Информация актуальна на июль 2024 года.*  
#### Где можно увидеть текущее количество сделанных запросов?  
Эту информацию можно найти на [**Дашборде Google Cloud Platform**](https://console.cloud.google.com/apis/dashboard?hl=ru), выбрав нужный проект.  
#### Как увеличить лимиты?  
Эту информацию можно найти в официальной документации Google — [**Request a higher quota**](https://cloud.google.com/docs/quotas/view-manage#requesting_higher_quota).  
#### Как ZennoDroid расходует лимиты?  
На количество запросов влияют два фактора: *изменялась ли таблица* и *включена ли загрузка сторонних изменений*.  

Например, если загрузка сторонних изменений включена, то каждую минуту будет отправляться запрос к API Google Drive для сравнения версий таблиц.  

При изменении самой таблицы используются разные виды запросов. Примерно до 5 запросов на таблицу в минуту. То есть если активно меняются 10 таблиц, то будет максимум около 60 запросов в минуту (Sheets API + Drive API).  
_______________________________________________
### Ошибка авторизации (403: access_denied).  
#### Подробный текст ошибки:  
*The developer hasn’t given you access to this app. It’s currently being tested and it hasn’t been verified by Google. If you think you should have access, contact the developer*.  
#### Причина:  
Вы пытаетесь авторизоваться в приложение, которое находится в ***Testing Mode*** с аккаунта, который не находится в списке тестовых пользователей (и не является его создателем). 
_______________________________________________
## Полезные ссылки. 
- [**Google Cloud**](https://console.cloud.google.com). 
- [**Гид по Google Таблицам**](https://www.unisender.com/ru/blog/google-tablicy-dlya-nachinayushchih/). 
 

